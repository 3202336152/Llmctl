# ctl å‘½ä»¤æ“ä½œæŒ‡å—

æœ¬æŒ‡å—è¯¦ç»†ä»‹ç» ctl å·¥å…·çš„æ‰€æœ‰å‘½ä»¤å’Œä½¿ç”¨æ–¹æ³•ã€‚

## ðŸ“š ç›®å½•

- [åŸºç¡€å‘½ä»¤](#åŸºç¡€å‘½ä»¤)
- [Provider ç®¡ç†](#provider-ç®¡ç†)
- [ä¼šè¯ç®¡ç†](#ä¼šè¯ç®¡ç†)
- [Token åˆ‡æ¢](#token-åˆ‡æ¢)
- [Token ç®¡ç†](#token-ç®¡ç†)
- [çŽ¯å¢ƒå˜é‡å¯¼å‡º](#çŽ¯å¢ƒå˜é‡å¯¼å‡º)
- [é…ç½®éªŒè¯](#é…ç½®éªŒè¯)
- [æ¨¡æ¿ç®¡ç†](#æ¨¡æ¿ç®¡ç†)
- [é«˜çº§ä½¿ç”¨](#é«˜çº§ä½¿ç”¨)
  - [å¼€å‘å’Œè°ƒè¯•](#å¼€å‘å’Œè°ƒè¯•)
- [æœ€ä½³å®žè·µ](#æœ€ä½³å®žè·µ)
- [æ•…éšœæŽ’é™¤](#æ•…éšœæŽ’é™¤)

## åŸºç¡€å‘½ä»¤

### `ctl` (æ— å‚æ•°)
é¦–æ¬¡è¿è¡Œæ—¶å¯åŠ¨å¼•å¯¼å‘å¯¼ï¼Œå¸®åŠ©æ‚¨é…ç½®ç¬¬ä¸€ä¸ª Providerã€‚

```bash
ctl
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
ðŸŽ‰ æ¬¢è¿Žä½¿ç”¨ ctlï¼
ðŸ” æ£€æµ‹åˆ°æ‚¨è¿˜æ²¡æœ‰é…ç½®ä»»ä½• LLM Provider
ðŸš€ è®©æˆ‘ä»¬å¼€å§‹é…ç½®æ‚¨çš„ç¬¬ä¸€ä¸ª Provider...
```

### `ctl --help` / `ctl -h`
æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯å’Œæ‰€æœ‰å¯ç”¨å‘½ä»¤ã€‚

```bash
ctl --help
```

### `ctl --version` / `ctl -V`
æ˜¾ç¤ºå½“å‰ç‰ˆæœ¬ä¿¡æ¯ã€‚

```bash
ctl --version
```

## Provider ç®¡ç†

### `ctl add` - æ·»åŠ  Provider

#### äº¤äº’å¼æ·»åŠ  (æŽ¨è)
```bash
ctl add
```

**äº¤äº’æµç¨‹ï¼š**
1. é€‰æ‹© Provider ç±»åž‹ (ç›®å‰æ”¯æŒ Anthropic)
2. è¾“å…¥ Provider åç§° (ä¼šè‡ªåŠ¨ç”Ÿæˆ ID)
3. è¾“å…¥æè¿° (å¯é€‰)
4. ç¡®è®¤æˆ–è‡ªå®šä¹‰ Provider ID
5. è¾“å…¥ Base URL
6. è¾“å…¥ API Token
7. è¾“å…¥æ¨¡åž‹åç§° (ANTHROPIC_MODELï¼Œå¯é€‰)
8. è¾“å…¥æœ€å¤§è¾“å‡ºTokenæ•° (CLAUDE_CODE_MAX_OUTPUT_TOKENSï¼Œå¯é€‰)
9. é€‰æ‹©æ˜¯å¦ç«‹å³ä½¿ç”¨è¯¥ Provider (ä¼šè‡ªåŠ¨è®¾ç½®çŽ¯å¢ƒå˜é‡)

**ç¤ºä¾‹å¯¹è¯ï¼š**
```
ðŸ”§ é…ç½® LLM API é…ç½®:

? è¯·è¾“å…¥ Provider åç§°: æˆ‘çš„Claudeé…ç½®
? è¯·è¾“å…¥ Provider æè¿° (å¯é€‰): æ—¥å¸¸å¼€å‘ä½¿ç”¨
ðŸ†” ä½¿ç”¨ Provider ID: wo-de-claude-pei-zhi
? è¯·è¾“å…¥ API URL: https://api.lycheeshare.com
? è¯·è¾“å…¥ API Token: [éšè—è¾“å…¥]
? è¯·è¾“å…¥æ¨¡åž‹åç§° (ANTHROPIC_MODELï¼Œå¯é€‰): claude-sonnet-4-20250514
? è¯·è¾“å…¥æœ€å¤§è¾“å‡ºTokenæ•° (CLAUDE_CODE_MAX_OUTPUT_TOKENSï¼Œå¯é€‰): 8000
âœ… æˆåŠŸæ·»åŠ  Provider: æˆ‘çš„Claudeé…ç½®
? æ˜¯å¦ç«‹å³é€‰æ‹©æ­¤ Provider ä½œä¸ºå½“å‰ä½¿ç”¨çš„ Provider? Yes
ðŸŽ¯ å·²é€‰æ‹© "æˆ‘çš„Claudeé…ç½®" ä½œä¸ºå½“å‰ Provider
ðŸ”„ æ­£åœ¨è‡ªåŠ¨è®¾ç½®çŽ¯å¢ƒå˜é‡...
å³å°†è®¾ç½®çš„çŽ¯å¢ƒå˜é‡:
  ANTHROPIC_AUTH_TOKEN=********...
  ANTHROPIC_BASE_URL=https://api.lycheeshare.com
  ANTHROPIC_MODEL=claude-sonnet-4-20250514
  CLAUDE_CODE_MAX_OUTPUT_TOKENS=8000

âœ… å·²è‡ªåŠ¨è®¾ç½® 4 ä¸ªçŽ¯å¢ƒå˜é‡
```

#### ä½¿ç”¨ç‰¹å®šæ¨¡æ¿
```bash
ctl add --template anthropic
```

#### æŸ¥çœ‹å¯ç”¨æ¨¡æ¿
```bash
ctl add --list-templates
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
ðŸ“‹ å¯ç”¨çš„ Provider æ¨¡æ¿:

1. LLM API é…ç½®
   ID: anthropic
   æè¿°: é…ç½®å¤§è¯­è¨€æ¨¡åž‹ API (æ”¯æŒ Claudeã€GLMã€Qwen ç­‰)
   çŽ¯å¢ƒå˜é‡: ANTHROPIC_AUTH_TOKEN, ANTHROPIC_BASE_URL, ANTHROPIC_MODEL
```

### `ctl list` / `ctl ls` - åˆ—å‡º Providers

#### åŸºæœ¬åˆ—è¡¨
```bash
ctl list
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
ðŸ“‹ å·²é…ç½®çš„ LLM Providers:

ðŸŽ¯ wo-de-claude-pei-zhi (æˆ‘çš„Claudeé…ç½®) - å½“å‰ä½¿ç”¨
   ç±»åž‹: Anthropic Claude
   Base URL: https://api.lycheeshare.com

   gong-zuo-yong-claude (å·¥ä½œç”¨Claude)
   ç±»åž‹: Anthropic Claude
   Base URL: https://api.anthropic.com
```

#### è¯¦ç»†ä¿¡æ¯
```bash
ctl list --verbose
```

#### JSON æ ¼å¼è¾“å‡º
```bash
ctl list --json
```

### `ctl use` - é€‰æ‹© Provider

#### äº¤äº’å¼é€‰æ‹©
```bash
ctl use
```

**äº¤äº’ç¤ºä¾‹ï¼š**
```
? è¯·é€‰æ‹©è¦ä½¿ç”¨çš„ Provider:
â¯ wo-de-claude-pei-zhi (æˆ‘çš„Claudeé…ç½®) - å½“å‰ä½¿ç”¨
  gong-zuo-yong-claude (å·¥ä½œç”¨Claude)

âœ… å·²é€‰æ‹© "å·¥ä½œç”¨Claude" ä½œä¸ºå½“å‰ Provider
ðŸ”„ æ­£åœ¨è‡ªåŠ¨è®¾ç½®çŽ¯å¢ƒå˜é‡...
å³å°†è®¾ç½®çš„çŽ¯å¢ƒå˜é‡:
  ANTHROPIC_AUTH_TOKEN=********...
  ANTHROPIC_BASE_URL=https://api.anthropic.com
  ANTHROPIC_MODEL=

âœ… å·²è‡ªåŠ¨è®¾ç½® 2 ä¸ªçŽ¯å¢ƒå˜é‡
```

#### ç›´æŽ¥æŒ‡å®š Provider
```bash
ctl use gong-zuo-yong-claude
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
âœ… å·²é€‰æ‹© "å·¥ä½œç”¨Claude" ä½œä¸ºå½“å‰ Provider
ðŸ”„ æ­£åœ¨è‡ªåŠ¨è®¾ç½®çŽ¯å¢ƒå˜é‡...
å³å°†è®¾ç½®çš„çŽ¯å¢ƒå˜é‡:
  ANTHROPIC_AUTH_TOKEN=********...
  ANTHROPIC_BASE_URL=https://api.anthropic.com

âœ… å·²è‡ªåŠ¨è®¾ç½® 2 ä¸ªçŽ¯å¢ƒå˜é‡
```

> **æ³¨æ„**: `ctl use` ä¼šè‡ªåŠ¨è®¾ç½®çŽ¯å¢ƒå˜é‡ï¼Œæ— éœ€æ‰‹åŠ¨æ‰§è¡Œ `ctl export`ã€‚

#### æ˜¾ç¤ºå¯é€‰æ‹©çš„åˆ—è¡¨
```bash
ctl use --list
```

### `ctl edit` / `ctl update` - ä¿®æ”¹ Provider é…ç½®

#### äº¤äº’å¼ä¿®æ”¹
```bash
ctl edit
```

**äº¤äº’ç¤ºä¾‹ï¼š**
```
? è¯·é€‰æ‹©è¦ä¿®æ”¹çš„ Provider:
â¯ GLM (glm) - glm4.5æ¨¡åž‹
  QWEN (qwen) - Qwenæ¨¡åž‹

ðŸ”§ ä¿®æ”¹ Provider: GLM

ðŸ“‹ å½“å‰é…ç½®:
   é…ç½®åç§°: GLM
   é…ç½®æè¿°: glm4.5æ¨¡åž‹
   APIåœ°å€: https://api.example.com
   APIå¯†é’¥: sk-lycheeshare-abc123def456

? è¯·é€‰æ‹©è¦ä¿®æ”¹çš„å­—æ®µ:
â¯ âœ“ é…ç½®åç§° (å½“å‰: GLM)
  âœ“ APIåœ°å€ (å½“å‰: https://api.example.com)
  âœ“ APIå¯†é’¥ (å½“å‰: sk-lycheeshare-abc123def456)

? è¯·è¾“å…¥æ–°çš„ é…ç½®åç§°: GLM-4.5
? è¯·è¾“å…¥æ–°çš„ APIåœ°å€: https://api.newprovider.com
? è¯·è¾“å…¥æ–°çš„ APIå¯†é’¥: [éšè—è¾“å…¥]
âœ… æˆåŠŸä¿®æ”¹ Provider: GLM-4.5
```

#### ç›´æŽ¥ä¿®æ”¹æŒ‡å®š Provider
```bash
ctl edit glm
ctl update qwen
```

#### æ”¯æŒä¿®æ”¹çš„å­—æ®µ
- **é…ç½®åç§°** - Provider æ˜¾ç¤ºåç§°
- **é…ç½®æè¿°** - Provider æè¿°ä¿¡æ¯
- **APIåœ°å€** - API æŽ¥å£åœ°å€
- **APIå¯†é’¥** - API è®¤è¯å¯†é’¥
- **æ¨¡åž‹åç§°** - ANTHROPIC_MODEL çŽ¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰
- **æœ€å¤§è¾“å‡ºTokenæ•°** - CLAUDE_CODE_MAX_OUTPUT_TOKENS çŽ¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰

**æ³¨æ„äº‹é¡¹ï¼š**
- ä¿®æ”¹ä¼šè‡ªåŠ¨éªŒè¯é…ç½®æœ‰æ•ˆæ€§
- å¦‚æžœä¿®æ”¹çš„æ˜¯å½“å‰ä½¿ç”¨çš„ Providerï¼Œå»ºè®®ä½¿ç”¨ `ctl use` é‡æ–°é€‰æ‹©ä»¥è‡ªåŠ¨æ›´æ–°çŽ¯å¢ƒå˜é‡
- æ‰€æœ‰ä¿®æ”¹éƒ½ä¼šä¿å­˜åˆ°é…ç½®æ–‡ä»¶ä¸­

### `ctl current` - æ˜¾ç¤ºå½“å‰ Provider

#### åŸºæœ¬ä¿¡æ¯
```bash
ctl current
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
ðŸŽ¯ å½“å‰ä½¿ç”¨çš„ Provider:

ID: wo-de-claude-pei-zhi
åç§°: æˆ‘çš„Claudeé…ç½®
æè¿°: æ—¥å¸¸å¼€å‘ä½¿ç”¨
ç±»åž‹: Anthropic Claude
Base URL: https://api.lycheeshare.com
```

#### è¯¦ç»†ä¿¡æ¯
```bash
ctl current --verbose
```

#### JSON æ ¼å¼
```bash
ctl current --json
```

### `ctl remove` / `ctl rm` - åˆ é™¤ Provider

#### äº¤äº’å¼åˆ é™¤
```bash
ctl remove
```

**äº¤äº’ç¤ºä¾‹ï¼š**
```
? è¯·é€‰æ‹©è¦åˆ é™¤çš„ Provider:
  wo-de-claude-pei-zhi (æˆ‘çš„Claudeé…ç½®) - å½“å‰ä½¿ç”¨
â¯ gong-zuo-yong-claude (å·¥ä½œç”¨Claude)

âš ï¸  åˆ é™¤ Provider å°†æ— æ³•æ¢å¤ï¼
? ç¡®è®¤åˆ é™¤ Provider "gong-zuo-yong-claude"? Yes
âœ… æˆåŠŸåˆ é™¤ Provider: gong-zuo-yong-claude
```

#### ç›´æŽ¥åˆ é™¤æŒ‡å®š Provider
```bash
ctl remove gong-zuo-yong-claude
```

#### å¼ºåˆ¶åˆ é™¤ (æ— ç¡®è®¤æç¤º)
```bash
ctl remove gong-zuo-yong-claude --force
```

#### åˆ é™¤æ‰€æœ‰ Providers (å±é™©æ“ä½œ)
```bash
ctl remove --all
```

## ä¼šè¯ç®¡ç†

llmctl æä¾›æ™ºèƒ½çš„CLIä¼šè¯ç®¡ç†åŠŸèƒ½ï¼Œè‡ªåŠ¨è·Ÿè¸ªå’Œç®¡ç†å½“å‰è¿è¡Œçš„CLIå·¥å…·ä¼šè¯ã€‚

### `ctl sessions` - æŸ¥çœ‹æ´»è·ƒä¼šè¯

#### æ˜¾ç¤ºæ‰€æœ‰æ´»è·ƒä¼šè¯
```bash
ctl sessions
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
ðŸ“Š æ´»è·ƒçš„CLIä¼šè¯:

ðŸ”¹ Claude (claude):
   1. PID: 12345 | è¿è¡Œ: 25åˆ†é’Ÿ | æœ€åŽæ´»åŠ¨: 2åˆ†é’Ÿå‰
      ç›®å½•: /home/user/project-a
      å‘½ä»¤: ctl-use

   2. PID: 12678 | è¿è¡Œ: 15åˆ†é’Ÿ | æœ€åŽæ´»åŠ¨: 1åˆ†é’Ÿå‰
      ç›®å½•: /home/user/project-b
      å‘½ä»¤: ctl-use

ðŸ”¹ GLM (glm):
   1. PID: 12890 | è¿è¡Œ: 5åˆ†é’Ÿ | æœ€åŽæ´»åŠ¨: 30ç§’å‰
      ç›®å½•: /home/user/project-c
      å‘½ä»¤: ctl-use
```

**ä¼šè¯ä¿¡æ¯è¯´æ˜Žï¼š**
- **PID**: è¿›ç¨‹æ ‡è¯†ç¬¦ï¼Œç”¨äºŽå”¯ä¸€è¯†åˆ«ä¼šè¯
- **è¿è¡Œæ—¶é—´**: ä¼šè¯å¯åŠ¨åˆ°çŽ°åœ¨çš„æ—¶é—´
- **æœ€åŽæ´»åŠ¨**: æœ€åŽä¸€æ¬¡è®°å½•æ´»åŠ¨çš„æ—¶é—´
- **ç›®å½•**: CLIä¼šè¯çš„å·¥ä½œç›®å½•ï¼ˆè‡ªåŠ¨ä¿å­˜ï¼‰
- **å‘½ä»¤**: å¯åŠ¨CLIçš„å‘½ä»¤ç±»åž‹

#### æ— æ´»è·ƒä¼šè¯æ—¶çš„è¾“å‡º
```bash
ctl sessions
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
ðŸ“­ å½“å‰æ²¡æœ‰æ´»è·ƒçš„CLIä¼šè¯

ðŸ’¡ æç¤ºï¼š
  - ä½¿ç”¨ ctl use å¯åŠ¨CLIå·¥å…·åŽä¼šè‡ªåŠ¨æ³¨å†Œä¼šè¯
  - ä¼šè¯ä¼šåœ¨CLIè¿›ç¨‹ç»“æŸæ—¶è‡ªåŠ¨æ¸…ç†
```

### ä¼šè¯è‡ªåŠ¨ç®¡ç†

#### ä¼šè¯æ³¨å†Œ
```bash
# å½“æ‚¨ä½¿ç”¨ ctl use é€‰æ‹©Providerå¹¶å¯åŠ¨CLIæ—¶
ctl use my-claude-provider

# ç³»ç»Ÿä¼šï¼š
# 1. è‡ªåŠ¨æ³¨å†Œä¼šè¯ä¿¡æ¯
# 2. ä¿å­˜å½“å‰å·¥ä½œç›®å½•
# 3. è®°å½•Providerä¿¡æ¯
# 4. è·Ÿè¸ªè¿›ç¨‹PID
```

#### ä¼šè¯æ¸…ç†
- **è‡ªåŠ¨æ¸…ç†**: å½“CLIè¿›ç¨‹ç»“æŸæ—¶ï¼Œä¼šè¯è‡ªåŠ¨ä»Žåˆ—è¡¨ä¸­ç§»é™¤
- **è¿›ç¨‹æ£€æµ‹**: ç³»ç»Ÿä¼šå®šæœŸæ£€æµ‹è¿›ç¨‹æ˜¯å¦ä»åœ¨è¿è¡Œ
- **éžæŒä¹…åŒ–**: ä¼šè¯ä¿¡æ¯ä¸ä¼šæ°¸ä¹…ä¿å­˜ï¼Œé‡å¯ç³»ç»ŸåŽä¼šè‡ªåŠ¨æ¸…ç©º

## Token åˆ‡æ¢

llmctl çš„Tokenåˆ‡æ¢åŠŸèƒ½ä¸“é—¨ä¸ºè§£å†³Tokené¢åº¦ç”¨å®Œæ—¶çš„å¿«é€Ÿåˆ‡æ¢éœ€æ±‚è€Œè®¾è®¡ï¼Œæ”¯æŒæ™ºèƒ½ä¼šè¯ç®¡ç†å’Œæ— ç¼é‡å¯ã€‚

### `ctl switch-token` - æ™ºèƒ½Tokenåˆ‡æ¢

#### äº¤äº’å¼åˆ‡æ¢ï¼ˆæŽ¨èï¼‰
```bash
ctl switch-token
```

**å®Œæ•´äº¤äº’æµç¨‹ï¼š**
```
ðŸ“‹ é€‰æ‹©è¦åˆ‡æ¢Tokençš„Provider (ä»…æ˜¾ç¤ºæœ‰æ´»è·ƒä¼šè¯çš„):

> Claude (8ä¸ªToken) - 2ä¸ªæ´»è·ƒä¼šè¯
  GLM (å•Token) - 1ä¸ªæ´»è·ƒä¼šè¯
  å–æ¶ˆ

ðŸ”„ æ­£åœ¨ä¸º "Claude" åˆ‡æ¢Token...
âœ… Tokenåˆ‡æ¢æˆåŠŸ
ðŸ“ å½“å‰Token: backup-token (sk-ant-...)

ðŸ” æ£€æµ‹åˆ° 2 ä¸ªæ´»è·ƒçš„ Claude CLIä¼šè¯
âš ï¸  ç”±äºŽCLIå·¥å…·ä¼šç¼“å­˜Tokenï¼Œéœ€è¦é‡å¯æ‰èƒ½ä½¿ç”¨æ–°Token

ðŸ“‹ è¯·é€‰æ‹©è¦é‡å¯çš„ä¼šè¯:
> ä¼šè¯1: PID 12345 | ç›®å½•: /home/user/project-a | è¿è¡Œ: 25åˆ†é’Ÿ
  ä¼šè¯2: PID 12678 | ç›®å½•: /home/user/project-b | è¿è¡Œ: 15åˆ†é’Ÿ
  ðŸ”„ é‡å¯æ‰€æœ‰ä¼šè¯
  âŒ å–æ¶ˆæ“ä½œ

ðŸ”„ å¼€å§‹è‡ªåŠ¨é‡å¯CLIè¿›ç¨‹...
æ­£åœ¨ç»ˆæ­¢è¿›ç¨‹ 12345...
âœ… å·²ç»ˆæ­¢è¿›ç¨‹ 12345
ðŸš€ åœ¨æ–°çª—å£å¯åŠ¨CLIï¼Œå·¥ä½œç›®å½•: /home/user/project-a
âœ… ä¼šè¯å·²é‡å¯ï¼Œè¯·æŸ¥çœ‹æ–°æ‰“å¼€çš„CLIçª—å£
ðŸ’¡ å¯ä»¥æ‰‹åŠ¨å…³é—­åŽŸå§‹çª—å£ï¼Œæ–°Tokenå·²åœ¨æ–°çª—å£ä¸­ç”Ÿæ•ˆ

ðŸŽ‰ Tokenåˆ‡æ¢å®Œæˆï¼
ðŸ’¡ æ–°Tokenå·²åœ¨æ–°çª—å£ä¸­ç”Ÿæ•ˆï¼Œå¯ä»¥æ‰‹åŠ¨å…³é—­åŽŸå§‹çª—å£
```

#### ç›´æŽ¥æŒ‡å®šProvideråˆ‡æ¢
```bash
ctl switch-token claude-provider
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
ðŸ”„ æ­£åœ¨ä¸º "Claude Provider" åˆ‡æ¢Token...
âœ… Tokenåˆ‡æ¢æˆåŠŸ
ðŸ“ å½“å‰Token: main-token (sk-ant-...)

ðŸ” æ£€æµ‹åˆ° 1 ä¸ªæ´»è·ƒçš„ Claude CLIä¼šè¯
âš ï¸  ç”±äºŽCLIå·¥å…·ä¼šç¼“å­˜Tokenï¼Œéœ€è¦é‡å¯æ‰èƒ½ä½¿ç”¨æ–°Token

ðŸ”„ å¼€å§‹è‡ªåŠ¨é‡å¯CLIè¿›ç¨‹...
æ­£åœ¨ç»ˆæ­¢è¿›ç¨‹ 12345...
âœ… å·²ç»ˆæ­¢è¿›ç¨‹ 12345
ðŸš€ åœ¨æ–°çª—å£å¯åŠ¨CLIï¼Œå·¥ä½œç›®å½•: /home/user/project-a
âœ… ä¼šè¯å·²é‡å¯ï¼Œè¯·æŸ¥çœ‹æ–°æ‰“å¼€çš„CLIçª—å£
ðŸ’¡ å¯ä»¥æ‰‹åŠ¨å…³é—­åŽŸå§‹çª—å£ï¼Œæ–°Tokenå·²åœ¨æ–°çª—å£ä¸­ç”Ÿæ•ˆ
```

### Tokenåˆ‡æ¢æ ¸å¿ƒç‰¹æ€§

#### ðŸ” æ™ºèƒ½ä¼šè¯æ£€æµ‹
- **æ´»è·ƒä¼šè¯è¿‡æ»¤**: åªæ˜¾ç¤ºæœ‰æ­£åœ¨è¿è¡ŒCLIä¼šè¯çš„Provider
- **ç²¾ç¡®ä¼šè¯è¯†åˆ«**: é€šè¿‡PIDå‡†ç¡®è¯†åˆ«æ¯ä¸ªCLIè¿›ç¨‹
- **å®žæ—¶çŠ¶æ€æ£€æµ‹**: è‡ªåŠ¨è¿‡æ»¤å·²ç»“æŸçš„ä¼šè¯

#### ðŸ“ å·¥ä½œç›®å½•ä¿æŠ¤
- **è‡ªåŠ¨ä¿å­˜**: åœ¨å¯åŠ¨CLIæ—¶è‡ªåŠ¨ä¿å­˜å·¥ä½œç›®å½•
- **ç²¾ç¡®æ¢å¤**: é‡å¯æ—¶åœ¨ç›¸åŒç›®å½•ä¸­å¯åŠ¨æ–°CLI
- **å¤šé¡¹ç›®æ”¯æŒ**: æ”¯æŒåœ¨ä¸åŒç›®å½•ä¸­è¿è¡Œå¤šä¸ªCLIå®žä¾‹

#### ðŸ–¥ï¸ å¤šä¼šè¯ç®¡ç†
- **é€‰æ‹©æ€§é‡å¯**: å¯ä»¥é€‰æ‹©é‡å¯ç‰¹å®šä¼šè¯æˆ–æ‰€æœ‰ä¼šè¯
- **å¹¶å‘æ”¯æŒ**: åŒæ—¶ç®¡ç†å¤šä¸ªä¸åŒProviderçš„ä¼šè¯
- **ç‹¬ç«‹æ“ä½œ**: å„ä¸ªä¼šè¯ä¹‹é—´äº’ä¸å½±å“

#### ðŸš€ è‡ªåŠ¨é‡å¯æœºåˆ¶
- **è¿›ç¨‹ç»ˆæ­¢**: ä¼˜é›…ç»ˆæ­¢æ—§çš„CLIè¿›ç¨‹
- **æ–°çª—å£å¯åŠ¨**: åœ¨ç³»ç»Ÿæ–°çª—å£ä¸­å¯åŠ¨CLI
- **Tokenç”Ÿæ•ˆ**: æ–°CLIè‡ªåŠ¨ä½¿ç”¨åˆ‡æ¢åŽçš„Token
- **ç”¨æˆ·å‹å¥½**: æä¾›æ¸…æ™°çš„æ“ä½œæç¤ºå’ŒçŠ¶æ€åé¦ˆ

### ä½¿ç”¨åœºæ™¯è¯¦è§£

#### åœºæ™¯1: å•ä¼šè¯Tokenåˆ‡æ¢
```bash
# å½“Claude CLIé‡åˆ°quota exceededé”™è¯¯æ—¶
# 1. ä¿æŒClaude CLIçª—å£ä¸åŠ¨ï¼Œæ–°å¼€ç»ˆç«¯
# 2. æ‰§è¡ŒTokenåˆ‡æ¢
ctl switch-token

# 3. é€‰æ‹©Claude Providerï¼ˆå¦‚æžœåªæœ‰ä¸€ä¸ªæ´»è·ƒä¼šè¯ä¼šè‡ªåŠ¨å¤„ç†ï¼‰
# 4. ç³»ç»Ÿè‡ªåŠ¨åˆ‡æ¢Tokenå¹¶é‡å¯CLI
# 5. æ–°CLIçª—å£ä¼šåœ¨ç›¸åŒç›®å½•ä¸­å¯åŠ¨
# 6. æ—§çª—å£å¯ä»¥æ‰‹åŠ¨å…³é—­
```

#### åœºæ™¯2: å¤šä¼šè¯é€‰æ‹©æ€§åˆ‡æ¢
```bash
# åŒæ—¶è¿è¡Œå¤šä¸ªé¡¹ç›®çš„Claude CLIï¼š
# - Project A: /home/user/project-a (PID: 12345)
# - Project B: /home/user/project-b (PID: 12678)

ctl switch-token

# é€‰æ‹©Claude ProvideråŽä¼šæ˜¾ç¤ºï¼š
# > ä¼šè¯1: PID 12345 | ç›®å½•: /home/user/project-a | è¿è¡Œ: 25åˆ†é’Ÿ
#   ä¼šè¯2: PID 12678 | ç›®å½•: /home/user/project-b | è¿è¡Œ: 15åˆ†é’Ÿ
#   ðŸ”„ é‡å¯æ‰€æœ‰ä¼šè¯
#   âŒ å–æ¶ˆæ“ä½œ

# å¯ä»¥é€‰æ‹©åªé‡å¯Project Açš„ä¼šè¯ï¼ŒProject Bä¸å—å½±å“
```

#### åœºæ™¯3: å¤šProviderçŽ¯å¢ƒ
```bash
# åŒæ—¶ä½¿ç”¨Claudeå’ŒGLMï¼š
ctl switch-token

# åªæ˜¾ç¤ºæœ‰æ´»è·ƒä¼šè¯çš„Providerï¼š
# > Claude (8ä¸ªToken) - 2ä¸ªæ´»è·ƒä¼šè¯
#   GLM (å•Token) - 1ä¸ªæ´»è·ƒä¼šè¯

# å¯ä»¥åˆ†åˆ«ä¸ºä¸åŒProvideråˆ‡æ¢Tokenï¼Œäº’ä¸å½±å“
```

### Tokenåˆ‡æ¢æœ€ä½³å®žè·µ

#### 1. é¢„é˜²æ€§Tokenç®¡ç†
```bash
# å®šæœŸæ£€æŸ¥TokençŠ¶æ€ï¼Œé¿å…è¿è¡Œæ—¶ä¸­æ–­
ctl token list

# ç¡®ä¿æ¯ä¸ªProvideréƒ½é…ç½®äº†å¤šä¸ªToken
ctl token add
```

#### 2. ä¼šè¯çŠ¶æ€ç›‘æŽ§
```bash
# å®šæœŸæŸ¥çœ‹æ´»è·ƒä¼šè¯
ctl sessions

# åŠæ—¶æ¸…ç†æ— ç”¨çš„ä¼šè¯ï¼ˆé€šå¸¸ä¼šè‡ªåŠ¨æ¸…ç†ï¼‰
```

#### 3. å·¥ä½œæµé›†æˆ
```bash
# å»ºè®®çš„é”™è¯¯å¤„ç†å·¥ä½œæµï¼š
# 1. Claude CLIæŠ¥quota exceeded
# 2. Ctrl+N æˆ– Cmd+T æ–°å¼€ç»ˆç«¯æ ‡ç­¾
# 3. ctl switch-token
# 4. é€‰æ‹©å¯¹åº”Providerå’Œä¼šè¯
# 5. ç­‰å¾…æ–°çª—å£å¯åŠ¨
# 6. å…³é—­æ—§çª—å£ï¼Œç»§ç»­å·¥ä½œ
```

#### 4. å›¢é˜Ÿåä½œ
- **ç»Ÿä¸€Tokenç®¡ç†**: å›¢é˜Ÿæˆå‘˜ä½¿ç”¨ç›¸åŒçš„Provideré…ç½®ç»“æž„
- **ä¼šè¯éš”ç¦»**: ä¸åŒé¡¹ç›®ä½¿ç”¨ä¸åŒå·¥ä½œç›®å½•ï¼Œé¿å…æ··æ·†
- **Tokenè½®æ¢**: å®šæœŸæ›´æ–°å’Œè½®æ¢Tokenï¼Œä¿æŒé…ç½®åŒæ­¥

### é”™è¯¯å¤„ç†å’Œæ•…éšœæŽ’é™¤

#### å¸¸è§é—®é¢˜1: æ‰¾ä¸åˆ°æ´»è·ƒä¼šè¯
```bash
ctl switch-token
# è¾“å‡ºï¼šðŸ“­ å½“å‰æ²¡æœ‰æ´»è·ƒçš„CLIä¼šè¯

# è§£å†³æ–¹æ¡ˆï¼š
# 1. å…ˆå¯åŠ¨CLIå·¥å…·
ctl use your-provider
# 2. é€‰æ‹©å¯åŠ¨CLIå·¥å…·
# 3. ç„¶åŽå†æ‰§è¡ŒTokenåˆ‡æ¢
```

#### å¸¸è§é—®é¢˜2: å·¥ä½œç›®å½•ä¸¢å¤±
```bash
# å¦‚æžœé‡å¯åŽç›®å½•ä¸å¯¹ï¼Œè¯´æ˜Žä¼šè¯ä¿¡æ¯ä¸¢å¤±
# è§£å†³æ–¹æ¡ˆï¼š
# 1. ä½¿ç”¨ç»å¯¹è·¯å¾„é‡æ–°å¯åŠ¨CLI
cd /correct/project/path
ctl use your-provider

# 2. æˆ–è€…åœ¨switch-tokenæ—¶æ‰‹åŠ¨æŒ‡å®šç›®å½•
# ç³»ç»Ÿä¼šè¯¢é—®æ‚¨é€‰æ‹©æ­£ç¡®çš„ç›®å½•
```

#### å¸¸è§é—®é¢˜3: æ–°çª—å£æ²¡æœ‰å¯åŠ¨
```bash
# å¦‚æžœè‡ªåŠ¨å¯åŠ¨å¤±è´¥ï¼Œä¼šæ˜¾ç¤ºæ‰‹åŠ¨æ“ä½œæŒ‡å¯¼ï¼š
# âš ï¸  å¯åŠ¨æ–°çª—å£å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æ‰§è¡Œ: ctl use your-provider

# è§£å†³æ–¹æ¡ˆï¼š
# 1. æ‰‹åŠ¨æ‰“å¼€æ–°ç»ˆç«¯
# 2. cd åˆ°æ­£ç¡®ç›®å½•
# 3. æ‰§è¡Œ ctl use your-provider
```

## çŽ¯å¢ƒå˜é‡å¯¼å‡º

### `ctl export` - å¯¼å‡ºçŽ¯å¢ƒå˜é‡

#### è‡ªåŠ¨æ£€æµ‹æ ¼å¼å¹¶å¯¼å‡º
```bash
ctl export
```

#### é¢„è§ˆå¯¼å‡ºå†…å®¹ (ä¸å®žé™…è®¾ç½®)
```bash
ctl export --dry-run
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
ðŸ” å°†è¦å¯¼å‡ºçš„çŽ¯å¢ƒå˜é‡:

ANTHROPIC_AUTH_TOKEN=sk-lycheeshare-...
ANTHROPIC_BASE_URL=https://api.lycheeshare.com

ðŸ“ åœ¨ bash/zsh ä¸­ä½¿ç”¨: ctl export
ðŸ“ åœ¨ PowerShell ä¸­ä½¿ç”¨: ctl export --format powershell | Invoke-Expression
ðŸ“ åœ¨ CMD ä¸­ä½¿ç”¨: ctl export --format cmd > env.bat && call env.bat
```

#### æŒ‡å®šæ ¼å¼å¯¼å‡º

**Bash/Zsh æ ¼å¼:**
```bash
ctl export --format bash
```

**PowerShell æ ¼å¼:**
```bash
ctl export --format powershell
# ä½¿ç”¨æ–¹å¼ï¼š
ctl export --format powershell | Invoke-Expression
```

**Windows CMD æ ¼å¼:**
```bash
ctl export --format cmd
# ä½¿ç”¨æ–¹å¼ï¼š
ctl export --format cmd > env.bat && call env.bat
```

**JSON æ ¼å¼:**
```bash
ctl export --format json
```

#### å¯¼å‡ºæŒ‡å®š Provider çš„çŽ¯å¢ƒå˜é‡
```bash
ctl export --provider gong-zuo-yong-claude
```

#### éªŒè¯å¯¼å‡ºçš„çŽ¯å¢ƒå˜é‡
```bash
ctl export --validate
```

## é…ç½®éªŒè¯

### `ctl validate` - éªŒè¯é…ç½®

#### éªŒè¯å½“å‰é…ç½®å’Œæ´»è·ƒ Provider
```bash
ctl validate
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
ðŸ” éªŒè¯é…ç½®å’Œ Providers...

âœ… é…ç½®æ–‡ä»¶ç»“æž„æ­£ç¡®
âœ… å½“å‰ Provider "wo-de-claude-pei-zhi" é…ç½®æœ‰æ•ˆ
âœ… çŽ¯å¢ƒå˜é‡å®Œæ•´
âœ… API Token æ ¼å¼æ­£ç¡®
âœ… Base URL æ ¼å¼æ­£ç¡®

ðŸŽ‰ æ‰€æœ‰éªŒè¯é€šè¿‡ï¼
```

#### ä»…éªŒè¯é…ç½®æ–‡ä»¶
```bash
ctl validate --config
```

#### éªŒè¯æŒ‡å®š Provider
```bash
ctl validate --provider wo-de-claude-pei-zhi
```

#### éªŒè¯æ‰€æœ‰ Providers
```bash
ctl validate --all
```

#### JSON æ ¼å¼è¾“å‡º
```bash
ctl validate --json
```

## æ¨¡æ¿ç®¡ç†

### `ctl template` / `ctl templates` - ç®¡ç† Provider æ¨¡æ¿

#### åˆ—å‡ºæ‰€æœ‰æ¨¡æ¿
```bash
ctl template list
ctl templates ls
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
ðŸ“‹ å¯ç”¨çš„ Provider æ¨¡æ¿ (1):

1. LLM API é…ç½®
   ID: anthropic
   æè¿°: é…ç½®å¤§è¯­è¨€æ¨¡åž‹ APIæè¿° (æ”¯æŒ Claudeã€GLMã€Qwen ç­‰)
   çŽ¯å¢ƒå˜é‡: ANTHROPIC_AUTH_TOKEN, ANTHROPIC_BASE_URL, ANTHROPIC_MODEL, CLAUDE_CODE_MAX_OUTPUT_TOKENS
```

#### JSON æ ¼å¼è¾“å‡º
```bash
ctl template list --json
```

#### æŸ¥çœ‹æ¨¡æ¿è¯¦æƒ…
```bash
ctl template show anthropic
ctl template info anthropic
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
ðŸ“„ æ¨¡æ¿è¯¦æƒ…: LLM API é…ç½®

ID: anthropic
åç§°: LLM API é…ç½®
æè¿°: é…ç½®å¤§è¯­è¨€æ¨¡åž‹ APIæè¿° (æ”¯æŒ Claudeã€GLMã€Qwen ç­‰)

çŽ¯å¢ƒå˜é‡:
  ANTHROPIC_AUTH_TOKEN: (ç”¨æˆ·é…ç½®)
  ANTHROPIC_BASE_URL: https://api.lycheeshare.com
  ANTHROPIC_MODEL: (å¯é€‰)
  CLAUDE_CODE_MAX_OUTPUT_TOKENS: (å¯é€‰)

é»˜è®¤å€¼:
  baseUrl: https://api.lycheeshare.com
  modelName: (ç©ºå€¼ï¼Œä»…ä¸­è½¬æ—¶éœ€è¦é…ç½®)
  maxTokens: 4096
  temperature: 0.7

é…ç½®é¡¹:
  1. è¯·è¾“å…¥ API URL:
     ç±»åž‹: input
     å¿…å¡«: å¦

  2. è¯·è¾“å…¥ API Token:
     ç±»åž‹: password
     å¿…å¡«: æ˜¯

  3. è¯·è¾“å…¥æ¨¡åž‹åç§° (ANTHROPIC_MODELï¼Œä»…ä¸­è½¬æ—¶éœ€è¦):
     ç±»åž‹: input
     å¿…å¡«: å¦
     é»˜è®¤å€¼: (ç©ºå€¼)
```

#### åˆ›å»ºè‡ªå®šä¹‰æ¨¡æ¿
```bash
ctl template create
ctl template new
```

**åˆ›å»ºæµç¨‹ï¼š**
```
ðŸŽ¨ åˆ›å»ºè‡ªå®šä¹‰ Provider æ¨¡æ¿

? è¯·è¾“å…¥æ¨¡æ¿ ID: openai
? è¯·è¾“å…¥æ¨¡æ¿åç§°: OpenAI GPT
? è¯·è¾“å…¥æ¨¡æ¿æè¿°: OpenAI GPT æ¨¡åž‹é…ç½®

ðŸ”§ é…ç½®çŽ¯å¢ƒå˜é‡:
? è¯·è¾“å…¥çŽ¯å¢ƒå˜é‡åç§°: OPENAI_API_KEY
? è¯·è¾“å…¥é»˜è®¤å€¼ (ç•™ç©ºè¡¨ç¤ºç”¨æˆ·é…ç½®):
? æ˜¯å¦ç»§ç»­æ·»åŠ çŽ¯å¢ƒå˜é‡? No

ðŸ“ é…ç½®ç”¨æˆ·è¾“å…¥é¡¹:
? è¯·é€‰æ‹©è¾“å…¥ç±»åž‹: å¯†ç è¾“å…¥
? è¯·è¾“å…¥å­—æ®µåç§°: apiKey
? è¯·è¾“å…¥æç¤ºæ–‡æœ¬: è¯·è¾“å…¥ OpenAI API Key:
? è¯·è¾“å…¥é»˜è®¤å€¼ (å¯é€‰):
? æ˜¯å¦å¿…å¡«? Yes
? æ˜¯å¦ç»§ç»­æ·»åŠ è¾“å…¥é¡¹? No

âœ… æ¨¡æ¿åˆ›å»ºå®Œæˆï¼
```

**æ¨¡æ¿ç±»åž‹æ”¯æŒï¼š**
- **æ–‡æœ¬è¾“å…¥** - æ™®é€šæ–‡æœ¬å­—æ®µ
- **å¯†ç è¾“å…¥** - éšè—è¾“å…¥çš„æ•æ„Ÿä¿¡æ¯
- **ç¡®è®¤é€‰æ‹©** - æ˜¯/å¦é€‰æ‹©
- **å•é€‰åˆ—è¡¨** - å•é€‰é€‰é¡¹
- **å¤šé€‰åˆ—è¡¨** - å¤šé€‰é€‰é¡¹

**æ³¨æ„äº‹é¡¹ï¼š**
- è‡ªå®šä¹‰æ¨¡æ¿ä¼šç”Ÿæˆ JSON é…ç½®å’Œç¤ºä¾‹ä»£ç 
- éœ€è¦é€šè¿‡ç¼–ç¨‹æ–¹å¼æ³¨å†Œåˆ°ç³»ç»Ÿä¸­
- æ¨¡æ¿ ID åªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—ã€è¿žå­—ç¬¦å’Œä¸‹åˆ’çº¿
- çŽ¯å¢ƒå˜é‡åç§°åº”ä½¿ç”¨å¤§å†™å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿

## Token ç®¡ç†

llmctl æ”¯æŒä¸ºå•ä¸ªProvideré…ç½®å¤šä¸ªAPI Tokenï¼Œå®žçŽ°è´Ÿè½½å‡è¡¡å’Œæ•…éšœåˆ‡æ¢ã€‚

### `ctl token` - Token ç®¡ç†ä¸»å‘½ä»¤

#### è¿›å…¥äº¤äº’å¼ç®¡ç†ç•Œé¢
```bash
ctl token                     # é€‰æ‹© Provider åŽè¿›å…¥ç®¡ç†ç•Œé¢
ctl token my-claude-provider  # ç›´æŽ¥ç®¡ç†æŒ‡å®š Provider çš„ Token
```

**äº¤äº’ç•Œé¢åŒ…å«:**
```
ðŸ”§ Tokenç®¡ç† - æˆ‘çš„Claudeé…ç½®
axian â­ [å½“å‰ä½¿ç”¨] | ðŸ“Š 4/5å¯ç”¨ | ðŸ”„ è½®è¯¢ç­–ç•¥

é€‰æ‹©æ“ä½œ:
> ðŸš« ç¦ç”¨å½“å‰Token (axian)
  ðŸ“‹ Tokenåˆ—è¡¨ (4âœ… 1âŒ)
  âž• æ·»åŠ Token
  ðŸ“¦ æ‰¹é‡æ“ä½œ
  âš™ï¸ é«˜çº§è®¾ç½® (3é¡¹)
  ðŸšª é€€å‡º
```

### `ctl token add` - æ·»åŠ  Token

#### å¿«é€Ÿæ·»åŠ æ¨¡å¼
```bash
ctl token add                     # é€‰æ‹© Provider åŽæ·»åŠ 
ctl token my-claude-provider add  # ä¸ºæŒ‡å®š Provider æ·»åŠ 
```

**é…ç½®ç¤ºä¾‹:**
```
âž• æ·»åŠ æ–°Token

? è¯·è¾“å…¥Tokenå€¼: [éšè—è¾“å…¥]
? Tokenåˆ«å (å¯é€‰ï¼Œæ–¹ä¾¿è¯†åˆ«): backup-token
? æƒé‡ (1-10ï¼Œç”¨äºŽåŠ æƒè½®è¯¢): 2

âœ… Tokenæ·»åŠ æˆåŠŸ (backup-token)
ðŸ’¡ Tokené»˜è®¤å¯ç”¨å¹¶åŠ å…¥è½®è¯¢æ± 
```

**é…ç½®é¡¹è¯´æ˜Ž:**
- **Tokenå€¼**: API Tokenå­—ç¬¦ä¸²ï¼ˆå¿…å¡«ï¼Œè¾“å…¥æ—¶ä¼šè¢«æŽ©ç ï¼‰
- **åˆ«å**: Tokençš„å‹å¥½åç§°ï¼ˆå¯é€‰ï¼Œå»ºè®®è®¾ç½®ä¾¿äºŽç®¡ç†ï¼‰
- **æƒé‡**: 1-10çš„æ•°å­—ï¼Œç”¨äºŽåŠ æƒè½®è¯¢ç­–ç•¥ï¼Œæƒé‡è¶Šé«˜ä½¿ç”¨é¢‘çŽ‡è¶Šé«˜ï¼Œé»˜è®¤å¯ç”¨å¹¶ç›´æŽ¥åŠ å…¥è½®è¯¢æ± 

### `ctl token list` - æŸ¥çœ‹ Token åˆ—è¡¨

#### æ˜¾ç¤º Token çŠ¶æ€
```bash
ctl token list                     # é€‰æ‹© Provider åŽæŸ¥çœ‹
ctl token my-claude-provider list  # æŸ¥çœ‹æŒ‡å®š Provider çš„ Token
```

**è¾“å‡ºç¤ºä¾‹:**
```
ðŸ“‹ Tokenåˆ—è¡¨

1. main-token â­ [å½“å‰ä½¿ç”¨]
   Token: sk-ant-01...
   æƒé‡: 3 | çŠ¶æ€: [å·²å¯ç”¨]

2. backup-token
   Token: sk-ant-02...
   æƒé‡: 2 | çŠ¶æ€: [å·²å¯ç”¨]

3. test-token
   Token: sk-ant-03...
   æƒé‡: 1 | çŠ¶æ€: [å·²ç¦ç”¨]
```

**çŠ¶æ€è¯´æ˜Ž:**
- **[å·²å¯ç”¨]** - Tokenå¤„äºŽå¯ç”¨çŠ¶æ€ï¼Œå¯ç”¨äºŽè½®è¯¢
- **[å·²ç¦ç”¨]** - æ‰‹åŠ¨ç¦ç”¨çš„Tokenï¼Œä¸å‚ä¸Žè½®è¯¢

### `ctl token strategy` - è®¾ç½®è½®è¯¢ç­–ç•¥

#### é…ç½®è½®è¯¢ç­–ç•¥
```bash
ctl token strategy                     # é€‰æ‹© Provider åŽè®¾ç½®
ctl token my-claude-provider strategy  # ä¸ºæŒ‡å®š Provider è®¾ç½®ç­–ç•¥
```

**é…ç½®ç¤ºä¾‹:**
```
? é€‰æ‹©è½®è¯¢ç­–ç•¥:
â¯ ðŸ”„ è½®è¯¢ (Round Robin) - ä¾æ¬¡ä½¿ç”¨æ¯ä¸ªToken
  âš–ï¸  åŠ æƒè½®è¯¢ (Weighted) - æŒ‰æƒé‡åˆ†é…ä½¿ç”¨é¢‘çŽ‡
  ðŸŽ² éšæœºé€‰æ‹© (Random) - éšæœºé€‰æ‹©Token
  ðŸ“Š æœ€å°‘ä½¿ç”¨ (Least Used) - ä¼˜å…ˆä½¿ç”¨æœ€å°‘ä½¿ç”¨çš„Token

? æœ€å¤§é‡è¯•æ¬¡æ•° (1-10): 3

âœ… è½®è¯¢ç­–ç•¥å·²è®¾ç½®ä¸º: åŠ æƒè½®è¯¢
```

#### è½®è¯¢ç­–ç•¥è¯¦è§£

##### ðŸ”„ è½®è¯¢ (Round Robin)
- **å·¥ä½œåŽŸç†**: æŒ‰é¡ºåºå¾ªçŽ¯ä½¿ç”¨æ¯ä¸ªToken
- **é€‚ç”¨åœºæ™¯**: æ‰€æœ‰Tokenæ€§èƒ½ç›¸åŒï¼Œéœ€è¦å‡åŒ€åˆ†é…
- **ç¤ºä¾‹**: Token1 â†’ Token2 â†’ Token3 â†’ Token1 â†’ ...

##### âš–ï¸ åŠ æƒè½®è¯¢ (Weighted Round Robin)
- **å·¥ä½œåŽŸç†**: æ ¹æ®æƒé‡ç²¾ç¡®åˆ†é…è¯·æ±‚æ¯”ä¾‹
- **é€‚ç”¨åœºæ™¯**: Tokenæœ‰ä¸åŒé™é¢æˆ–æ€§èƒ½ç­‰çº§
- **ç¤ºä¾‹**: æƒé‡3:2:1çš„ä¸‰ä¸ªTokenï¼ŒæŒ‰ç…§3:2:1çš„æ¯”ä¾‹åˆ†é…è¯·æ±‚
- **ç®—æ³•**: å®žçŽ°äº†çœŸæ­£çš„WRRç®—æ³•ï¼Œç¡®ä¿ç²¾ç¡®æŒ‰æ¯”ä¾‹åˆ†é…

##### ðŸŽ² éšæœºé€‰æ‹© (Random)
- **å·¥ä½œåŽŸç†**: éšæœºé€‰æ‹©å¯ç”¨Token
- **é€‚ç”¨åœºæ™¯**: ç®€å•åœºæ™¯ï¼Œä¸éœ€è¦ç²¾ç¡®æŽ§åˆ¶
- **ç‰¹ç‚¹**: å®Œå…¨éšæœºï¼Œé•¿æœŸä½¿ç”¨è¶‹äºŽå‡åŒ€

##### ðŸ“Š æœ€å°‘ä½¿ç”¨ (Least Used)
- **å·¥ä½œåŽŸç†**: ä¼˜å…ˆé€‰æ‹©æœ€ä¹…æœªä½¿ç”¨çš„Token
- **é€‚ç”¨åœºæ™¯**: å¸Œæœ›Tokenä½¿ç”¨æ›´åŠ å‡åŒ€
- **ç‰¹ç‚¹**: åŸºäºŽæœ€åŽä½¿ç”¨æ—¶é—´æˆ³é€‰æ‹©

#### ç­–ç•¥å‚æ•°é…ç½®

**æœ€å¤§é‡è¯•æ¬¡æ•° (maxRetries)**
- èŒƒå›´: 1-10æ¬¡
- é»˜è®¤: 3æ¬¡
- è¯´æ˜Ž: å½“Tokenå‡ºé”™æ—¶ï¼Œæœ€å¤šé‡è¯•å‡ æ¬¡åŽåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªToken

### Token é«˜çº§ç®¡ç†

#### ç¼–è¾‘ Token
åœ¨äº¤äº’ç•Œé¢ä¸­é€‰æ‹©"ç¼–è¾‘Token":
```
? é€‰æ‹©è¦ç¼–è¾‘çš„Token:
â¯ main-token (sk-ant-01...) - æƒé‡:3
  backup-token (sk-ant-02...) - æƒé‡:2
  test-token (sk-ant-03...) - æƒé‡:1 [å·²ç¦ç”¨]

? Tokenåˆ«å: main-token
? æƒé‡ (1-10): 5
? æ˜¯å¦å¯ç”¨è¯¥Token? Yes

âœ… Tokenæ›´æ–°æˆåŠŸ
```

#### åˆ é™¤ Token
```
? é€‰æ‹©è¦åˆ é™¤çš„Token:
  main-token (sk-ant-01...)
â¯ backup-token (sk-ant-02...)

? ç¡®è®¤åˆ é™¤Token "backup-token"? Yes

âœ… Tokenåˆ é™¤æˆåŠŸ
```

**ç‰¹æ®Šæƒ…å†µ:**
- åˆ é™¤æœ€åŽä¸€ä¸ªTokenæ—¶ä¼šæç¤ºå›žåˆ°å•Tokenæ¨¡å¼
- åˆ é™¤å‰ä¼šæ˜¾ç¤ºç¡®è®¤æç¤ºé˜²æ­¢è¯¯æ“ä½œ

#### é‡ç½®é”™è¯¯è®¡æ•°
```bash
# åœ¨äº¤äº’ç•Œé¢ä¸­é€‰æ‹©"é‡ç½®é”™è¯¯è®¡æ•°"
# é‡ç½®æ‰€æœ‰Tokençš„é”™è¯¯è®¡æ•°ä¸º0ï¼Œæ¢å¤è¢«ç¦ç”¨çš„Token
```

#### æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯
```
ðŸ“Š Tokenç»Ÿè®¡ä¿¡æ¯

æ€»Tokenæ•°: 3
å¯ç”¨Token: 2
è½®è¯¢ç­–ç•¥: åŠ æƒè½®è¯¢

Tokenè¯¦æƒ…:
1. ðŸŸ¢ main-token
   æƒé‡: 3 | çŠ¶æ€: [å·²å¯ç”¨] | æœ€åŽä½¿ç”¨: 2024-01-15 14:32:10
2. ðŸŸ¢ backup-token
   æƒé‡: 2 | çŠ¶æ€: [å·²å¯ç”¨] | æœ€åŽä½¿ç”¨: 2024-01-15 13:45:22
3. ðŸ”´ test-token
   æƒé‡: 1 | çŠ¶æ€: [å·²ç¦ç”¨] | æœ€åŽä½¿ç”¨: ä»Žæœªä½¿ç”¨
```

**å›¾æ ‡è¯´æ˜Ž:**
- ðŸŸ¢/ðŸ”´: Tokenå¯ç”¨çŠ¶æ€ï¼ˆç»¿è‰²å¯ç”¨/çº¢è‰²ç¦ç”¨ï¼‰
- â­: å½“å‰ä½¿ç”¨çš„Token

### Token æ•…éšœå¤„ç†

#### è‡ªåŠ¨æ•…éšœåˆ‡æ¢
```
Token main-token è¯·æ±‚å¤±è´¥ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªToken
æ­£åœ¨ä½¿ç”¨ backup-token...
Token backup-token è¯·æ±‚å¤±è´¥ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªToken
æ­£åœ¨ä½¿ç”¨ test-token...
```

#### æ•…éšœæ¢å¤
- ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªå¯ç”¨Token
- å¯ä»¥æ‰‹åŠ¨ç¦ç”¨/å¯ç”¨æœ‰é—®é¢˜çš„Token
- æ”¯æŒæ‰¹é‡æ“ä½œç®¡ç†TokençŠ¶æ€

#### çŠ¶æ€ç›‘æŽ§
ç³»ç»Ÿä¼šè‡ªåŠ¨è·Ÿè¸ªæ¯ä¸ªTokençš„:
- å¯ç”¨/ç¦ç”¨çŠ¶æ€
- æœ€åŽä½¿ç”¨æ—¶é—´
- æƒé‡é…ç½®

### å¤šTokené…ç½®æœ€ä½³å®žè·µ

#### 1. Tokenåˆ†å±‚ç®¡ç†
```bash
# ä¸»Token - é«˜æƒé‡ï¼Œæ—¥å¸¸ä½¿ç”¨
main-token: æƒé‡5, åˆ«å"ä¸»è¦Token"

# å¤‡ç”¨Token - ä¸­æƒé‡ï¼Œæ•…éšœåˆ‡æ¢
backup-token: æƒé‡3, åˆ«å"å¤‡ç”¨Token"

# æµ‹è¯•Token - ä½Žæƒé‡ï¼Œå¼€å‘æµ‹è¯•
test-token: æƒé‡1, åˆ«å"æµ‹è¯•Token"
```

#### 2. æƒé‡é…ç½®å»ºè®®
- **ç”Ÿäº§çŽ¯å¢ƒ**: ä½¿ç”¨åŠ æƒè½®è¯¢ï¼Œä¸»Tokenæƒé‡è¾ƒé«˜
- **å¼€å‘çŽ¯å¢ƒ**: ä½¿ç”¨è½®è¯¢æˆ–éšæœºï¼Œå¹³å‡åˆ†é…
- **æµ‹è¯•çŽ¯å¢ƒ**: ä½¿ç”¨æœ€å°‘ä½¿ç”¨ï¼Œç¡®ä¿æ‰€æœ‰Tokenéƒ½è¢«æµ‹è¯•

#### 3. ç›‘æŽ§å’Œç»´æŠ¤
```bash
# å®šæœŸæ£€æŸ¥TokençŠ¶æ€
ctl token list

# æŸ¥çœ‹ä½¿ç”¨ç»Ÿè®¡
ctl token stats

# é‡ç½®é”™è¯¯è®¡æ•°ï¼ˆå¿…è¦æ—¶ï¼‰
ctl token reset
```

#### 4. å®‰å…¨è€ƒè™‘
- ä¸ºä¸åŒç”¨é€”çš„Tokenè®¾ç½®æ¸…æ™°çš„åˆ«å
- å®šæœŸè½®æ¢Tokenï¼Œåˆ é™¤æ—§çš„æ·»åŠ æ–°çš„
- ç›‘æŽ§Tokenä½¿ç”¨æƒ…å†µï¼ŒåŠæ—¶å‘çŽ°å¼‚å¸¸

#### 5. æ•…éšœé¢„æ¡ˆ
- ç¡®ä¿è‡³å°‘é…ç½®2ä¸ªä»¥ä¸ŠToken
- è®¾ç½®åˆç†çš„é‡è¯•æ¬¡æ•°
- å®šæœŸéªŒè¯æ‰€æœ‰Tokençš„æœ‰æ•ˆæ€§

## é«˜çº§ä½¿ç”¨

### å¼€å‘å’Œè°ƒè¯•

#### TypeScript ç¼–è¯‘æ£€æŸ¥
```bash
# æ£€æŸ¥ TypeScript ç¼–è¯‘é”™è¯¯
npx tsc --noEmit

# æ£€æŸ¥ç‰¹å®šæ–‡ä»¶
npx tsc --noEmit src/utils/env.ts

# æ£€æŸ¥å¹¶ç”Ÿæˆç±»åž‹å£°æ˜Žæ–‡ä»¶
npx tsc
```

#### ä»£ç è´¨é‡æ£€æŸ¥
```bash
# ESLint æ£€æŸ¥
npm run lint

# ESLint è‡ªåŠ¨ä¿®å¤
npm run lint:fix

# Prettier æ ¼å¼åŒ–
npm run format

# ç±»åž‹æ£€æŸ¥
npm run typecheck
```

#### æµ‹è¯•ç›¸å…³
```bash
# è¿è¡Œæµ‹è¯•
npm test

# è¿è¡Œæµ‹è¯•å¹¶æ˜¾ç¤ºè¦†ç›–çŽ‡
npm run test:coverage

# ç›‘å¬æ¨¡å¼è¿è¡Œæµ‹è¯•
npm run test:run
```

#### æž„å»ºé¡¹ç›®
```bash
# æž„å»ºé¡¹ç›®
npm run build

# å¼€å‘æ¨¡å¼æž„å»ºï¼ˆç›‘å¬æ–‡ä»¶å˜åŒ–ï¼‰
npm run dev
```

### æŸ¥çœ‹é…ç½®æ–‡ä»¶è·¯å¾„
```bash
ctl --config-path
```

### æ‰¹é‡æ“ä½œç¤ºä¾‹

#### æ·»åŠ å¤šä¸ª Providers
```bash
# æ·»åŠ å¼€å‘çŽ¯å¢ƒ Provider
ctl add --template anthropic
# åœ¨äº¤äº’ä¸­è®¾ç½®åç§°ä¸º "å¼€å‘çŽ¯å¢ƒClaude"

# æ·»åŠ ç”Ÿäº§çŽ¯å¢ƒ Provider
ctl add --template anthropic
# åœ¨äº¤äº’ä¸­è®¾ç½®åç§°ä¸º "ç”Ÿäº§çŽ¯å¢ƒClaude"
```

#### å¿«é€Ÿåˆ‡æ¢çŽ¯å¢ƒ
```bash
# åˆ‡æ¢åˆ°å¼€å‘çŽ¯å¢ƒ
ctl use kai-fa-huan-jing-claude
ctl export

# åˆ‡æ¢åˆ°ç”Ÿäº§çŽ¯å¢ƒ
ctl use sheng-chan-huan-jing-claude
ctl export
```

### é¡¹ç›®çº§é…ç½®

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.ctlrc` æ–‡ä»¶ï¼š

```json
{
  "provider": "kai-fa-huan-jing-claude",
  "autoExport": true
}
```

ç„¶åŽåœ¨é¡¹ç›®ç›®å½•ä¸­è¿è¡Œï¼š

```bash
ctl use $(cat .ctlrc | jq -r .provider)
ctl export
```

### çŽ¯å¢ƒå˜é‡æŒä¹…åŒ–

#### åœ¨ shell é…ç½®æ–‡ä»¶ä¸­è‡ªåŠ¨åŠ è½½

**Bash/Zsh** (`~/.bashrc` æˆ– `~/.zshrc`):
```bash
# ctl è‡ªåŠ¨åŠ è½½
if command -v ctl >/dev/null 2>&1; then
  if ctl current --json 2>/dev/null | jq -e '.activeProvider' >/dev/null; then
    eval "$(ctl export 2>/dev/null)"
  fi
fi
```

**PowerShell** (é…ç½®æ–‡ä»¶):
```powershell
# ctl è‡ªåŠ¨åŠ è½½
if (Get-Command ctl -ErrorAction SilentlyContinue) {
    $currentProvider = ctl current --json 2>$null | ConvertFrom-Json
    if ($currentProvider.activeProvider) {
        ctl export --format powershell | Invoke-Expression
    }
}
```

## æœ€ä½³å®žè·µ

### 1. Provider å‘½åè§„èŒƒ
- ä½¿ç”¨æœ‰æ„ä¹‰çš„åç§°ï¼šå¦‚ "å¼€å‘çŽ¯å¢ƒClaude", "å·¥ä½œç”¨GPT"
- é¿å…ç‰¹æ®Šå­—ç¬¦ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆé€‚åˆçš„ ID
- æ·»åŠ æè¿°è¯´æ˜Žç”¨é€”

### 2. å®‰å…¨è€ƒè™‘
- å®šæœŸæ›´æ–° API Token
- ä¸è¦åœ¨è„šæœ¬ä¸­ç¡¬ç¼–ç  Token
- ä½¿ç”¨ `ctl validate` æ£€æŸ¥é…ç½®

### 3. Provider ç®¡ç†
- **å®šæœŸç»´æŠ¤**: åˆ é™¤ä¸å†ä½¿ç”¨çš„ Provider
- **é…ç½®æ›´æ–°**: ä½¿ç”¨ `ctl edit` è€Œä¸æ˜¯æ‰‹åŠ¨ç¼–è¾‘é…ç½®æ–‡ä»¶
- **å¤‡ä»½é…ç½®**: é‡è¦é…ç½®ä¿®æ”¹å‰å…ˆå¯¼å‡ºå¤‡ä»½
  ```bash
  # å¤‡ä»½å½“å‰é…ç½®
  ctl list --json > providers-backup.json

  # ä¿®æ”¹é…ç½®
  ctl edit my-provider
  ```

### 4. æ¨¡æ¿ä½¿ç”¨
- **æŸ¥çœ‹çŽ°æœ‰æ¨¡æ¿**: æ·»åŠ  Provider å‰å…ˆæŸ¥çœ‹å¯ç”¨æ¨¡æ¿
  ```bash
  ctl template list
  ctl template show anthropic
  ```
- **è‡ªå®šä¹‰æ¨¡æ¿**: ä¸ºå›¢é˜Ÿå¸¸ç”¨çš„ LLM æä¾›å•†åˆ›å»ºç»Ÿä¸€æ¨¡æ¿
- **æ¨¡æ¿å‘½å**: ä½¿ç”¨æ¸…æ™°çš„æ¨¡æ¿ ID å’Œæè¿°

### 5. å·¥ä½œæµå»ºè®®
```bash
# æ¯æ—¥å·¥ä½œå¼€å§‹
ctl current                    # ç¡®è®¤å½“å‰ Provider
ctl use your-provider          # é€‰æ‹© Provider (è‡ªåŠ¨è®¾ç½®çŽ¯å¢ƒå˜é‡)
ctl validate                   # éªŒè¯é…ç½®

# å¯åŠ¨ Claude Code
claude-code
```

### 4. å›¢é˜Ÿåä½œ
- åˆ†äº«é…ç½®æ¨¡æ¿ï¼Œä¸è¦åˆ†äº« Token
- ä¸ºä¸åŒé¡¹ç›®åˆ›å»ºä¸åŒçš„ Provider
- ä½¿ç”¨ç»Ÿä¸€çš„å‘½åè§„èŒƒ

## æ•…éšœæŽ’é™¤

### å¸¸è§é—®é¢˜è§£å†³

#### 1. å‘½ä»¤æ— æ³•æ‰¾åˆ°
```bash
# æ£€æŸ¥å®‰è£…
npm list -g ctl

# é‡æ–°å®‰è£…
npm install -g ctl

# æ£€æŸ¥ PATH
echo $PATH
which ctl
```

#### 2. çŽ¯å¢ƒå˜é‡æœªç”Ÿæ•ˆ
```bash
# ç¡®ä¿ä½¿ç”¨ eval
ctl export

# æ£€æŸ¥å½“å‰ shell
echo $SHELL

# éªŒè¯å˜é‡
echo $ANTHROPIC_AUTH_TOKEN
```

#### 3. Provider éªŒè¯å¤±è´¥
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
ctl validate --provider your-provider --verbose

# é‡æ–°é…ç½®
ctl remove your-provider
ctl add
```

#### 4. API è¿žæŽ¥é—®é¢˜
```bash
# éªŒè¯é…ç½®
ctl validate

# æµ‹è¯• API è¿žæŽ¥
curl -X POST "$ANTHROPIC_BASE_URL/v1/messages" \
  -H "Authorization: Bearer $ANTHROPIC_AUTH_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"model": "claude-sonnet-4-20250514", "max_tokens": 100, "messages": [{"role": "user", "content": "Hello"}]}'
```

#### 5. Provider ä¿®æ”¹é—®é¢˜
```bash
# æŸ¥çœ‹å½“å‰é…ç½®
ctl current --verbose

# ä¿®æ”¹é…ç½®
ctl edit provider-id

# éªŒè¯ä¿®æ”¹ç»“æžœ
ctl validate --provider provider-id

# å¦‚æžœä¿®æ”¹å¤±è´¥ï¼Œæ£€æŸ¥è¾“å…¥æ ¼å¼
ctl template show anthropic  # æŸ¥çœ‹å­—æ®µè¦æ±‚
```

#### 6. æ¨¡æ¿ç›¸å…³é—®é¢˜
```bash
# æŸ¥çœ‹å¯ç”¨æ¨¡æ¿
ctl template list

# æŸ¥çœ‹æ¨¡æ¿è¯¦æƒ…
ctl template show template-id

# åˆ›å»ºæ¨¡æ¿æ—¶é‡åˆ°é—®é¢˜
# ç¡®ä¿æ¨¡æ¿ ID åªåŒ…å«: a-z, 0-9, -, _
# ç¡®ä¿çŽ¯å¢ƒå˜é‡ååªåŒ…å«: A-Z, 0-9, _
```

### è°ƒè¯•æ¨¡å¼

#### å¯ç”¨è¯¦ç»†è¾“å‡º
```bash
DEBUG=ctl:* ctl command
```

#### æŸ¥çœ‹é…ç½®æ–‡ä»¶
```bash
# æŸ¥çœ‹é…ç½®è·¯å¾„
ctl --config-path

# æŸ¥çœ‹é…ç½®å†…å®¹
cat "$(ctl --config-path)"

# æˆ–ä½¿ç”¨ ctl æŸ¥çœ‹
ctl list --json
```

### é‡ç½®é…ç½®

#### å®Œå…¨é‡ç½®
```bash
# åˆ é™¤æ‰€æœ‰ Providers
ctl remove --all

# é‡æ–°å¼€å§‹é…ç½®
ctl
```

#### ä¿®å¤æŸåçš„é…ç½®
```bash
# å¤‡ä»½å½“å‰é…ç½®
cp "$(ctl --config-path)" "$(ctl --config-path).backup"

# åˆ é™¤é…ç½®æ–‡ä»¶
rm "$(ctl --config-path)"

# é‡æ–°åˆå§‹åŒ–
ctl
```

## å¹³å°ç‰¹å®šè¯´æ˜Ž

### Windows

#### CMD ä¸­ä½¿ç”¨
```cmd
ctl export --format cmd > env.bat
call env.bat
echo %ANTHROPIC_AUTH_TOKEN%
```

#### PowerShell ä¸­ä½¿ç”¨
```powershell
ctl export --format powershell | Invoke-Expression
Write-Host $env:ANTHROPIC_AUTH_TOKEN
```

### macOS/Linux

#### Bash ä¸­ä½¿ç”¨
```bash
ctl export
echo $ANTHROPIC_AUTH_TOKEN
```

#### Zsh ä¸­ä½¿ç”¨
```zsh
ctl export
echo $ANTHROPIC_AUTH_TOKEN
```

---

æ›´å¤šé—®é¢˜å’Œå»ºè®®ï¼Œè¯·è®¿é—® [GitHub Issues](https://github.com/3202336152/ctl/issues)ã€‚